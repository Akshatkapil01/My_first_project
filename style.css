import streamlit as st
import google.generativeai as genai
import time

# 1. PAGE SETUP
st.set_page_config(page_title="GreenGuide", page_icon="ü•ó", layout="wide")

# 2. ADVANCED CSS (Animations, Custom Buttons, and Card Styling)
st.markdown("""
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700&display=swap');

    /* Global Styles */
    .stApp {
        background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
        font-family: 'Outfit', sans-serif;
    }

    /* Animated Title */
    .hero-title {
        font-size: 50px;
        font-weight: 700;
        text-align: center;
        color: #2e7d32;
        margin-top: -50px;
        letter-spacing: -1px;
    }

    /* Professional Modern Button */
    div.stButton > button:first-child {
        background: #2e7d32;
        color: white;
        border-radius: 15px;
        width: 100%;
        height: 3.5rem;
        font-size: 1.1rem;
        font-weight: 600;
        border: none;
        box-shadow: 0 10px 20px rgba(46, 125, 50, 0.2);
        transition: all 0.3s ease;
    }

    div.stButton > button:hover {
        background: #1b5e20;
        transform: translateY(-3px);
        box-shadow: 0 15px 30px rgba(46, 125, 50, 0.3);
        color: #ffffff;
    }

    /* Glassmorphism Recommendation Card */
    .recommendation-card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border-radius: 25px;
        padding: 35px;
        border: 1px solid rgba(255, 255, 255, 0.5);
        box-shadow: 0 20px 40px rgba(0,0,0,0.06);
        margin-top: 30px;
        animation: slideUp 0.8s ease-out;
    }

    @keyframes slideUp {
        from { opacity: 0; transform: translateY(40px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Input Box Focus Effect */
    .stTextInput input {
        border-radius: 12px !important;
        border: 1px solid #d1d1d1 !important;
        padding: 12px !important;
    }
    </style>
    """, unsafe_allow_html=True)

# 3. AI CONFIG
try:
    genai.configure(api_key=st.secrets["GOOGLE_API_KEY"])
    model = genai.GenerativeModel('gemini-2.0-flash')
except Exception:
    st.error("üîë API Key not found. Please add it to Streamlit Secrets.")
    st.stop()

# 4. APP INTERFACE
st.markdown("<h1 class='hero-title'>GreenGuide AI</h1>", unsafe_allow_html=True)
st.markdown("<p style='text-align: center; color: #555; font-size: 1.1rem;'>Smart Nutritional Intelligence</p>", unsafe_allow_html=True)

# Layout using columns
left_spacer, center_col, right_spacer = st.columns([1, 2, 1])

with center_col:
    user_query = st.text_input("", placeholder="Search for a fruit, veggie, or meal type...")
    
    c1, c2 = st.columns(2)
    with c1:
        diet_pref = st.selectbox("Dietary Style", ["Balanced", "Vegan", "Keto", "Vegetarian"])
    with c2:
        goal_pref = st.selectbox("Health Focus", ["Wellness", "Energy", "Budget"])
    
    analyze_btn = st.button("Generate Recommendation")

# 5. PROCESSING & OUTPUT
if analyze_btn:
    if user_query:
        # Step-by-step progress animation
        progress_bar = st.progress(0)
        status_text = st.empty()
        
        for i in range(100):
            time.sleep(0.01)
            progress_bar.progress(i + 1)
            if i == 20: status_text.text("Connecting to database...")
            if i == 60: status_text.text("Analyzing nutritional profile...")
            if i == 90: status_text.text("Finalizing your plan...")
        
        status_text.empty()
        progress_bar.empty()

        with st.spinner(""):
            prompt = f"""
            Act as a world-class nutritionist. Recommendation for: {user_query}.
            Diet: {diet_pref}. Goal: {goal_pref}. 
            Format:
            - üíé **Top Selection**: (with description)
            - üë®‚Äçüç≥ **Quick Recipe**: (3 steps)
            - ‚ö° **Health Benefit**: (1 power fact)
            """
            
            try:
                response = model.generate_content(prompt)
                # Output in custom Glassmorphism card
                st.markdown(f"""
                    <div class='recommendation-card'>
                        {response.text}
                    </div>
                """, unsafe_allow_html=True)
            except Exception:
                st.error("AI service is currently busy. Please try again.")
    else:
        st.warning("Please enter your query first!")

# 6. FOOTER
st.markdown("<br><hr><p style='text-align: center; color: #999;'>¬© 2026 GreenGuide AI Intelligence</p>", unsafe_allow_html=True)


